<h1>
  Liste des réservations
  <span id="reservations-count" aria-hidden="true"></span>
</h1>

<!-- ====== ACTION BUTTONS ====== -->

<div class="table-actions">
  <a href="/reservations/create" class="btn btn--primary btn--shadow">
    <i class="fa-solid fa-calendar-plus" aria-hidden="true"></i>
    Ajouter une réservation
  </a>

  <button id="delete-selected" class="btn btn-danger btn--shadow" disabled>
    Supprimer la sélection
    <span id="delete-selected-count" aria-hidden="true"></span>
  </button>
</div>

<!-- ====== FILTERS BAR ====== -->

<div class="filters-bar">
  <select id="filter-catway">
    <option value="">Tous les catways</option>
    <% for (let i = 1; i <= 20; i++) { %>
    <option value="<%= i %>">Catway <%= i %></option>
    <% } %>
  </select>

  <input
    id="filter-search"
    type="text"
    placeholder="Client ou bateau"
    aria-label="Rechercher un client ou un bateau"
  />

  <input id="filter-start" type="date" aria-label="Date de début" />
  <input id="filter-end" type="date" aria-label="Date de fin" />

  <button
    type="button"
    id="filters-reset"
    class="btn btn--primary btn-icon"
    aria-label="Réinitialiser les filtres"
  >
    <i class="fa-solid fa-arrow-rotate-left" aria-hidden="true"></i>
  </button>
</div>

<!-- ====== TABLE ====== -->

<div class="table-wrapper">
  <table class="data-table data-table--fixed is-clickable">
    <caption class="sr-only">
      Liste des réservations avec client, bateau, catway et période
    </caption>

    <colgroup>
      <col class="col-checkbox" />
      <col class="col-status" />
      <col class="col-auto" />
      <col class="col-auto" />
      <col class="col-catway" />
      <col class="col-date" />
      <col class="col-dash" />
      <col class="col-date" />
      <col class="col-action" />
      <col class="col-action" />
    </colgroup>

    <thead>
      <tr>
        <th scope="col" class="align-center checkbox">
          <input
            type="checkbox"
            id="select-all"
            aria-label="Sélectionner toutes les réservations"
          />
        </th>
        <th scope="col" class="align-center border-col-left border-col-right">
          Statut
        </th>
        <th scope="col" class="align-right">Client</th>
        <th scope="col" class="align-left">Bateau</th>
        <th scope="col" class="align-center">Catway</th>
        <th scope="col" class="align-center">Début</th>
        <th class="align-center" aria-hidden="true">&ndash;</th>
        <th scope="col" class="align-center">Fin</th>
        <th scope="col" class="align-center border-col-left">
          <span class="sr-only">Voir la réservation</span>
        </th>
        <th scope="col" class="align-center">
          <span class="sr-only">Éditer la réservation</span>
        </th>
      </tr>
    </thead>

    <tbody>
      <% if (!reservations || reservations.length === 0) { %>
      <tr>
        <td colspan="10" class="no-data" role="status">Aucune réservation.</td>
      </tr>
      <% } else { %> <% for (let i = 0; i < reservations.length; i++) { %>
      <tr
        class="js-reservation-row js-panel-row"
        data-entity-id="<%= reservations[i].id %>"
        data-catway-number="<%= reservations[i].catwayNumber %>"
        data-client="<%= reservations[i].clientName %>"
        data-boat="<%= reservations[i].boatName %>"
        data-start="<%= reservations[i].startDateISO %>"
        data-end="<%= reservations[i].endDateISO %>"
        data-highlight="<%= (flash?.highlightIds || []).includes(reservations[i].id.toString()) ? 'true' : 'false' %>"
      >
        <td class="align-center checkbox">
          <input
            type="checkbox"
            name="selectedReservations"
            value="<%= reservations[i].catwayNumber %>|<%=reservations[i].id %>"
            aria-label="Sélectionner la réservation de <%= reservations[i].clientName %>, bateau <%= reservations[i].boatName %>, du <%= reservations[i].startDateFormatted %> au <%= reservations[i].endDateFormatted %>"
          >
        </td>

        <td class="align-center border-col-left border-col-right">
          <span
            class="status <%= reservations[i].status.className %>"
            aria-label="<%= reservations[i].status.aria %>"
          >
            <%= reservations[i].status.label %>
          </span>
        </td>

        <td class="align-right"><%= reservations[i].clientName %></td>
        <td class="align-left bold"><%= reservations[i].boatName %></td>
        <td class="align-center"><%= reservations[i].catwayNumber %></td>
        <td class="align-center"><%= reservations[i].startDateFormatted %></td>
        <td class="align-center" aria-hidden="true">&ndash;</td>
        <td class="align-center"><%= reservations[i].endDateFormatted %></td>

        <td class="align-center actions border-col-left">
          <a
            href="/catways/<%= reservations[i].catwayNumber %>/reservations/<%= reservations[i].id %>"
            class="btn btn--primary btn-icon"
            aria-label="Voir le détail de la réservation de <%= reservations[i].clientName %>, bateau <%= reservations[i].boatName %>, du <%= reservations[i].startDateFormatted %> au <%= reservations[i].endDateFormatted %>"
          >
            <i
              class="fa-solid fa-arrow-up-right-from-square"
              aria-hidden="true"
            ></i>
          </a>
        </td>

        <td class="align-center actions">
          <a
            href="/catways/<%= reservations[i].catwayNumber %>/reservations/<%= reservations[i].id %>/edit"
            class="btn btn--primary btn-icon"
            aria-label="Éditer la réservation de <%= reservations[i].clientName %>, bateau <%= reservations[i].boatName %>, du <%= reservations[i].startDateFormatted %> au <%= reservations[i].endDateFormatted %>"
          >
            <i class="fa-solid fa-pen" aria-hidden="true"></i>
          </a>
        </td>
      </tr>
      <% } %> <% } %>

      <tr
        id="no-results-row"
        class="no-data"
        role="status"
        aria-live="polite"
        hidden
      >
        <td colspan="10">Aucune réservation correspondante</td>
      </tr>
    </tbody>
  </table>
</div>

<!-- ====== SCRIPTS ====== -->

<!-- PANEL -->
<script type="module" src="/js/ui/panel/reservationsPanel.js"></script>

<!-- HIGHLIGHT -->
<script type="module" src="/js/ui/animation/highlightCleanup.js"></script>

<!-- PANEL ACTIONS -->
<script type="module" src="/js/panel/panelDeleteAction.js"></script>
<script type="module" src="/js/panel/panelEditAction.js"></script>

<!-- TABLE INIT -->
<script type="module">
  import { initReservationsTable } from "/js/table/entities/reservationsTable.js";
  initReservationsTable();
</script>

<!-- LIVE FILTER -->
<script type="module">
  import { initReservationsLiveFilter } from "/js/table/filters/reservationsLiveFilter.js";
  initReservationsLiveFilter();
</script>

<!-- FLASH -->
<% if (flash) { %>
<script>
  window.addEventListener("DOMContentLoaded", () => {
    showToast("<%= flash.type %>", "<%= flash.message %>");
  });
</script>
<% } %>