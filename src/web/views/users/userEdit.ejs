<h1>Modification de l'utilisateur</h1>

<% if (globalError) { %>
  <div class="form-global-error" role="alert">
    <%= globalError %>
  </div>
<% } %>

<form
  method="POST"
  action="/users/<%= user.id %>/edit"
  class="form"
  data-entity-id="<%= user.id %>"
>
  <!--====== USERNAME =======-->

  <div class="form-group">
    <label for="username">Nom d'utilisateur</label>
    <input
      type="text"
      id="username"
      name="username"
      value="<%= user.username %>"
      aria-invalid="<%= errors.username ? 'true' : 'false' %>"
      data-invalid="<%= errors.username ? 'true' : '' %>"
      required
    >
    <% if (errors.username) { %>
    <p class="form-error"><%= errors.username %></p>
    <% } %>
  </div>

  <!--====== EMAIL =======-->

  <div class="form-group">
    <label for="email">Email</label>
    <input
      type="email"
      id="email"
      name="email"
      aria-describedby="email-feedback"
      value="<%= user.email %>"
      aria-invalid="<%= errors.email ? 'true' : 'false' %>"
      data-invalid="<%= errors.email ? 'true' : '' %>"
      autocomplete="off"
      required
    >
    <p id="email-error" class="form-error <%= errors.email ? '' : 'hidden' %>">
      <%= errors.email || "" %>
    </p>

    <p
      id="email-feedback"
      class="form-error hidden"
      data-source="ajax"
    ></p>
  </div>

  <!--====== BUTTONS ACTIONS =======-->

  <div class="form-actions">
    <a href="/users" class="btn btn-cancel">Annuler</a>
    <button type="submit" class="btn btn-confirm">Enregistrer</button>
  </div>
</form>

<!--====== PASSWORD =======-->

<form
  method="POST"
  action="/users/<%= user.id %>/edit/password"
  class="form"
  data-password-rules="<%- JSON.stringify(passwordRules || []) %>"
  data-entity-id="<%= user.id %>"
>
  <div class="form-group">
    <label for="password">
      Mot de passe
    </label>
    <div class="password-wrapper">
      <input
        type="password"
        id="password"
        name="password"
        autocomplete="new-password"
        aria-invalid="<%= errors.password ? 'true' : 'false' %>"
        data-invalid="<%= errors.password ? 'true' : '' %>"
      >
      <button
        type="button"
        class="toggle-password"
        aria-label="Afficher/Masquer le mot de passe"
      >
        <i class="fa-solid fa-eye"></i>
      </button>
    </div>

    <div class="password-strength">
      <div id="password-strength-bar" class="password-strength-bar"></div>
    </div>
    <p id="password-strength-label" class="password-strength-label"></p>

    <% if (errors.password?.message) { %>
    <p class="form-error"><%= errors.password.message %></p>
    <% } %>
    <%- include("../partials/passwordRules.ejs", { passwordRules, errors }) %>
  </div>

  <!--====== BUTTONS ACTIONS =======-->

  <div class="form-actions">
    <a href="/users" class="btn btn-cancel">Annuler</a>
    <button type="submit" class="btn btn-confirm">Enregistrer</button>
  </div>
</form>

<!--====== SCRIPTS =======-->

<script src="/js/form/availableEmail.js" defer></script>
<script src="/js/form/passwordValidation.js" defer></script>
<script src="/js/ui/form/passwordEye.js" defer></script>
<script src="/js/ui/form/formErrorCleanup.js" defer></script>
