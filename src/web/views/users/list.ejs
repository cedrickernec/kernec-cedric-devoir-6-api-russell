<h1>
  Liste des utilisateurs
  <span id="users-count" aria-hidden="true"></span>
</h1>

<!-- ====== ACTION BUTTONS ====== -->

<div class="table-actions">
  <a href="/users/create" class="btn btn--primary btn--shadow">
    <i class="fa-solid fa-user-plus" aria-hidden="true"></i>
    Ajouter un utilisateur
  </a>

  <button id="delete-selected" class="btn btn-danger btn--shadow" disabled>
    Supprimer la sélection
  </button>
</div>

<!-- ====== FILTERS BAR ====== -->

<div class="filters-bar">
  <!-- Recherche globale -->
  <input
    id="filter-search"
    type="text"
    placeholder="Recherche..."
    aria-label="Rechercher un utilisateur"
  />

  <button
    type="button"
    id="filters-reset"
    class="btn btn--primary btn-icon btn--icon-table"
    aria-label="Réinitialiser les filtres"
  >
    <i class="fa-solid fa-arrow-rotate-left" aria-hidden="true"></i>
  </button>
</div>

<!-- ====== TABLE ====== -->

<div class="table-wrapper">
  <table class="data-table data-table--fixed is-clickable">
    <caption class="sr-only">
      Liste des utilisateurs avec nom d'utilisateur et adresse email
    </caption>

    <colgroup>
      <col class="col-checkbox" />
      <col class="col-username" />
      <col class="col-auto" />
      <col class="col-action" />
      <col class="col-action" />
    </colgroup>

    <thead>
      <tr>
        <th scope="col" class="align-center checkbox">
          <input
            type="checkbox"
            id="select-all"
            aria-label="Sélectionner tous les utilisateurs"
          />
        </th>
        <th scope="col" class="align-left">Nom d'utilisateur</th>
        <th scope="col" class="align-left">Email</th>
        <th scope="col" class="align-center border-col-left">
          <span class="sr-only">
            Voir l'utilisateur
          </span>
        </th>
        <th scope="col" class="align-center">
          <span class="sr-only">
            Éditer l'utilisateur
          </span>
        </th>
      </tr>
    </thead>

    <tbody>
      <% for (let i = 0; i < users.length; i++) { %>
      <tr
        class="js-user-row js-panel-row"
        data-entity-id="<%= users[i].id %>"
        data-highlight="<%= flash?.highlightId === users[i].id ? 'true' : 'false' %>"
        data-user="<%= users[i].username.toLowerCase() %>"
        data-email="<%= users[i].email.toLowerCase() %>"
      >
        <td class="align-center checkbox">
          <input
            type="checkbox"
            name="selectedUsers"
            value="<%= users[i].id %>"
            aria-label="Sélectionner <%= users[i].username %>"
          />
        </td>
        <td class="align-left bold">
          <span class="cell-ellipsis"> <%= users[i].username %> </span>
        </td>
        <td class="align-left italic">
          <span class="cell-ellipsis"> <%= users[i].email %> </span>
        </td>
        <td class="align-center actions border-col-left">
          <a
            href="/users/<%= users[i].id %>"
            class="btn btn--primary btn-icon btn--icon-table"
            data-entity-id="<%= users[i].id %>"
            title="Ouvrir la fiche utilisateur complète"
            aria-label="Voir le détail de l'utilisateur <%= users[i].username %>"
          >
            <i
              class="fa-solid fa-arrow-up-right-from-square"
              aria-hidden="true"
            ></i>
          </a>
        </td>
        <td class="align-center actions">
          <a
            href="/users/<%= users[i].id %>/edit"
            class="btn btn--primary btn-icon btn--icon-table"
            title="Éditer l'utilisateur"
            aria-label="Éditer l'utilisateur <%= users[i].username %>"
            ><i class="fa-solid fa-pen" aria-hidden="true"></i
          ></a>
        </td>
      </tr>
      <% } %>

      <tr
        id="no-results-row"
        class="no-data"
        role="status"
        aria-live="polite"
        data-empty="Aucun utilisateur existant."
        data-filter="Aucun utilisateur correspondant."
        hidden
      >
        <td colspan="5" id="no-results-cell">
          <!-- Contenu injecté dynamiquement -->
        </td>
      </tr>
    </tbody>
  </table>
</div>

<!-- ====== SCRIPTS ====== -->

<!-- UI/PANEL -->
<script type="module" src="/js/ui/panel/usersPanel.js"></script>

<!-- UI/ANIMATIONS -->
<script type="module" src="/js/ui/animation/highlightCleanup.js"></script>

<!-- PANEL ACTIONS -->
<script type="module" src="/js/panel/panelDeleteAction.js"></script>
<script type="module" src="/js/panel/panelEditAction.js"></script>

<!-- TABLE INIT -->
<script type="module">
  import { initUsersTable } from "/js/table/entities/usersTable.js";
  initUsersTable();
</script>

<!-- LIVE FILTER -->
<script type="module">
  import { initUsersLiveFilter } from "/js/table/filters/usersLiveFilter.js";
  initUsersLiveFilter();
</script>

<!-- FEEDBACK (flash) -->
<% if (flash) { %>
<script>
  window.addEventListener("DOMContentLoaded", () => {
    showToast("<%= flash.type %>", "<%= flash.message %>");
  });
</script>
<% } %>
